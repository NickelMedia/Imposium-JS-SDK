<html>
	
	<head>
		<title>Imposium Basic + Analytics Example</title>
		<link rel="stylesheet" type="text/css" href="css/styles.css">
	</head>

	<body>
		
		<div>

			<h2>Enter a caption, upload an image, and hit Generate Video</h2>

			<label for = "caption">Caption</label>
			<input id = "caption" name = "caption" type = "text" placeholder = "Caption"/>
			<br/>

			<label for = "image">Image</label>
			<input id = "image" name = "image" type = "file"/>
			<br/>
			<br/>

			<button id = "btnGenerate">Generate Video</button>
			<br/>
			<br/>

			<span id = "status"></span>
			<br/>

			<video id = "dynamicVideo" controls autoplay></video>
		</div>
		
		<script type = "text/javascript" src = "../lib/imposium.min.js"></script>
		
		<script type = "text/javascript">
			var statusField = document.getElementById('status'),
				captionInput = document.getElementById('caption'),
				imageInput = document.getElementById('image'),
				vid = document.getElementById('dynamicVideo'),
				btnGenerate = document.getElementById('btnGenerate');

			// You will need the following variables 
			var STORY_ID    = '295a80d0-871c-4def-a579-8a375d6942fc',
				SCENE_ID    = 'f7a20d1f-96f2-4672-a7e3-3891b4a8ed25',
			    ACT_ID      = '295a80d0-871c-4def-a579-8a375d6942fc',
			    ACCESS_KEY  = 'zooch5ja8fiejoojoo6AeQuahmex1wes',
			    TRACKING_ID = 'UA-113079866-1';

			var imposium = new Imposium.ImposiumClient(ACCESS_KEY);
			var events = Imposium.Events;

			imposium.setupAnalytics(TRACKING_ID, vid);

			imposium.on(events.GOT_SCENE, function(data) {
				window.location.hash = '#' + data.experience_id;
				
				vid.src = data.mp4Url;
				vid.style.display = 'block';

				setStatus('Got Scene', 'green');
			});

			imposium.on(events.GOT_MESSAGE, function(data) {
				setStatus(data.msg, 'green');
			});

			imposium.on(events.ERROR, function(err) {
				setStatus('Something went wrong processing your experience.', 'red');
			});

			imposium.on(events.GOT_EXPERIENCE, function(data) {
				console.log(data);
			})

			//If there is a deeplink to an experience, connect to that experience
			if (window.location.hash !== '') {
			    var expId = window.location.hash.replace('#', '');

			    if (expId) {
			        var job = {
			        	expId: expId, 
			        	sceneId: SCENE_ID, 
			        	actId: ACT_ID
			        };

			        imposium.getVideo(expId);
			    }                   
			}

			// Bind the click event to the generate button
			btnGenerate.addEventListener('click', createExperience);

			// Creates an experience on Imposium, passing in the caption and/or image 
			function createExperience() {
			    // here you can specify a callback URL to hit once the video has rendered
			    var inventory = {
			        'text':captionInput.value,
			        'image':imageInput,
			        'callback_url':''
			    };
			    
			    imposium.renderVideo(
			        STORY_ID, 
			        SCENE_ID,
			        ACT_ID,
			        inventory
			    );

			    setStatus('Creating Experience', 'green');
			}

			// Helper that updates statusField div with incoming messages
			function setStatus(status, color) {
				this.statusField.innerHTML = status;
				this.statusField.style.color = color;
			}

		</script>
	</body>
</html>