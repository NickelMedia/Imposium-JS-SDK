<html>
	
	<head>
		<title>Imposium.js Example</title>
		<link rel="stylesheet" type="text/css" href="css/styles.css">
	</head>

	<body>
		
		<div>
			<h2>Enter a caption, Upload an image, and hit Generate Video</h2>
			<input id = "caption" type = "text" placeholder = "Caption"/>
			<input id = "image" type = "file"/>
			<button id = "btnGenerate">Generate Video</button>
			<span id = "status"></span>
			<video id = "dynamicVideo" controls autoplay></video>
		</div>
		
		<script type = "text/javascript" src = "../lib/imposium.js"></script>
		
		<script type = "text/javascript">

			var storyId = "819868af-daeb-408a-eb16-0f8f8a462d96",
			 	actId = "cd24347a-bc1d-4d75-cae7-a287872b10fa",
				accessKey = 'hF8EMmRK9kDzCVJSmwBslBDPEzM2FA',

				statusField = document.getElementById('status'),
				captionInput = document.getElementById('caption'),
				vid = document.getElementById('dynamicVideo'),
				experienceId;

			var imposium = new Imposium.ImposiumClient(accessKey);

			if (window.location.hash!="") {
				var expId = window.location.hash.replace("#","");
				if (expId) {
					imposium.startEventProcessor({
						'expId' : expId, 
						'actId' : actId
					}, gotScene, existingError);
				}					
			}

			document.getElementById('btnGenerate').addEventListener('click', createExperience);

			function createExperience(){

				var inventory = {
		    		'6fe605c1-7ee7-4122-d339-e3fd7dd3077b':captionInput.value
		    	};
		    	
				imposium.createExperience(storyId, inventory, false, experienceCreated, experienceError);
			}

			function experienceCreated(data){		

				console.log(data);

				experienceId = data.id;
				window.location.hash = "#" +experienceId;

				imposium.on(Imposium.events.STATUS, onStatusUpdate, this);

				imposium.startEventProcessor({
					'expId' : experienceId, 
					'actId' : actId,
				}, gotScene, eventProcessorError);
			}

			function gotScene(data){

				statusField.innerHTML = "Got Scene";
				vid.src = data.videoUrls.mp4_1080;
			}

			function onStatusUpdate(data){
				if(data.id == experienceId){
					statusField.innerHTML = data.msg;
				}
			}

			function experienceError(e){
				console.error("Error creating new experience");
				console.log(e);
			}

			function existingError(e){
				console.error("Error creating new experience");
				console.log(e);
			}

			function eventProcessorError(e){
				console.error("Error starting the event procesor");
				console.log(e);
			}

		</script>
	</body>
</html>